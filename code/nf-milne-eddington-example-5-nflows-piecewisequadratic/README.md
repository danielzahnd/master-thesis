# nf-milne-eddington-example-5-nflows-piecewisequadratic
This code experiments with normalizing flows used to invert Milne-Eddington atmospheres. In this case, a series of penumbra formation maps (Stokes parameters at different wavelengths for each pixel) is considered. This dataset contains maps of a certain FOV at different times to track the evolution of a penumbra in a sunspot. The last map of this dataset is always used as the testing set, while incrementally many maps prior to the last map are used as training data for a normalizing flow learning how to do Milne-Eddington inversions. The goal of this experiment would be to see, if taking into account incrementally many maps for training increases the performance of the inversion on the last map of the time series and furthermore if the "smoothing" effect of the normalizing flow vanishes or not. This fexperiment therefore provides further initial tests for the idea, that inversions can be vastly accelerated by means of using normalizing flows. That is, a map is initially inverted using a (sophisticated) inversion algorithm. After that, a normalizing flow can be trained on this inverted map and then applied to similar FOV's and maps, thereby greatly accelerating the inversion and furthermore providing one with not only parameter values, but distributions!

Used data for this experiment can be found at [penumbra-formation-maps](https://drive.google.com/drive/folders/1-W3vCJC4gEsQWW0pzwF8PbQ3erE0eGPI?usp=drive_link/) and [sunspot-map](https://drive.google.com/drive/folders/1AM6oA1mLYQ_DtIlSv52aYXDNDTygRQyq?usp=drive_link).
